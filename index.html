<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—á–µ–Ω—å–∫–∏ –∏ –±–æ–º–±—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 10px;
            background-color: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            padding: 15px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        
        .game-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #FFD700;
        }
        
        .user-id {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background-color: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .info-block {
            text-align: center;
        }
        
        .info-label {
            font-size: 14px;
            color: #666;
        }
        
        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .control-btn {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
        }
        
        .control-btn:hover {
            opacity: 0.9;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin-bottom: 15px;
        }
        
        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            background-color: #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        
        .cell:hover {
            background-color: #d0d0d0;
            transform: scale(1.02);
        }
        
        .cell.revealed.cookie {
            background-color: #90EE90;
            color: #006400;
        }
        
        .cell.revealed.bomb {
            background-color: #FF6B6B;
            color: #8B0000;
        }
        
        .stats {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .stat-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .menu-btn {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            text-align: center;
        }
        
        .menu-btn:hover {
            opacity: 0.9;
        }
        
        .bomb-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .bomb-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
        }
        
        .bomb-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #FF6B6B;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .slider-value {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B6B;
            min-width: 40px;
            text-align: center;
        }
        
        .settings-screen, .top-screen {
            display: none;
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .back-btn {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div class="menu-screen" id="menuScreen">
            <div class="header">
                <div class="game-title">–¢–µ—á–µ–Ω—å–∫–∏ –∏ –ë–æ–º–±—ã</div>
                <div class="user-id">ID: <span id="userId">1793309949</span></div>
            </div>
            
            <div class="game-info">
                <div class="info-block">
                    <div class="info-label">–õ—É—á—à–∏–π —Å—á–µ—Ç</div>
                    <div class="info-value" id="bestScore">0</div>
                </div>
                <div class="info-block">
                    <div class="info-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–º–±</div>
                    <div class="info-value" id="bombCountDisplay">1</div>
                </div>
            </div>
            
            <div class="bomb-counter">
                <div class="slider-value" id="bombSliderValue">1</div>
                <input type="range" class="bomb-slider" id="bombSlider" min="1" max="24" value="1">
                <div class="slider-value">24</div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <span>–ë–æ–º–±—ã</span>
                    <span class="stat-value" id="menuBombCount">1</span>
                </div>
                <div class="stat-item">
                    <span>–ü–µ—á–µ–Ω–µ–∫</span>
                    <span class="stat-value" id="menuCookieCount">24</span>
                </div>
            </div>
            
            <button class="menu-btn" id="startGameBtn">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            <button class="menu-btn" id="topPlayersBtn">–¢–û–ü –ò–ì–†–û–ö–û–í</button>
            <button class="menu-btn" id="settingsBtn">–ù–ê–°–¢–†–û–ô–ö–ò</button>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div class="game-screen" id="gameScreen" style="display: none;">
            <div class="header">
                <div class="game-title">–¢–µ—á–µ–Ω—å–∫–∏ –∏ –ë–æ–º–±—ã</div>
                <div class="user-id">–°—á–µ—Ç: <span id="currentScore">0</span></div>
            </div>
            
            <div class="game-info">
                <div class="info-block">
                    <div class="info-label">–ü–µ—á–µ–Ω–µ–∫</div>
                    <div class="info-value" id="gameCookiesFound">0/0</div>
                </div>
                <div class="info-block">
                    <div class="info-label">–ë–æ–º–±</div>
                    <div class="info-value" id="gameBombsLeft">0/0</div>
                </div>
            </div>
            
            <div class="game-board" id="gameBoard">
                <!-- –ö–ª–µ—Ç–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <div class="controls">
                <button class="control-btn" id="hintBtn">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                <button class="control-btn" id="restartBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                <button class="control-btn" id="menuBtn">–í –º–µ–Ω—é</button>
            </div>
        </div>
        
        <!-- –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="top-screen" id="topScreen" style="display: none;">
            <div class="header">
                <div class="game-title">–¢–û–ü –ò–ì–†–û–ö–û–í</div>
            </div>
            <div id="topPlayersList">
                <div style="text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <button class="back-btn" id="backFromTopBtn">–ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="settings-screen" id="settingsScreen" style="display: none;">
            <div class="header">
                <div class="game-title">–ù–ê–°–¢–†–û–ô–ö–ò</div>
            </div>
            
            <div class="settings-item">
                <span>–ó–≤—É–∫–∏</span>
                <label class="switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <span>–í–∏–±—Ä–∞—Ü–∏—è</span>
                <label class="switch">
                    <input type="checkbox" id="vibrationToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="settings-item">
                <span>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div style="margin-top: 20px; text-align: center; color: #666; font-size: 14px;">
                –í–µ—Ä—Å–∏—è 1.0.0<br>
                –ú–∞–∫—Å–∏–º—É–º 24 –±–æ–º–±—ã
            </div>
            
            <button class="back-btn" id="backFromSettingsBtn">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        const GRID_SIZE = 5;
        const COOKIE_POINTS = 20;
        const BOMB_PENALTY = 50;
        const WIN_BONUS = 300;
        
        let gameState = {
            grid: [],
            revealed: [],
            bombs: 1,
            score: 0,
            cookiesFound: 0,
            gameOver: false,
            gameWon: false
        };
        
        let currentScreen = 'menu';
        let soundEnabled = true;
        let vibrationEnabled = true;
        let bestScore = 0;
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            initMenu();
            setupEventListeners();
        });
        
        // ========== –ú–ï–ù–Æ –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï ==========
        function initMenu() {
            updateBombSlider();
            loadBestScore();
        }
        
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('topPlayersBtn').addEventListener('click', showTopPlayers);
            document.getElementById('settingsBtn').addEventListener('click', showSettings);
            
            // –ò–≥—Ä–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('hintBtn').addEventListener('click', giveHint);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('menuBtn').addEventListener('click', showMenu);
            
            // –ö–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
            document.getElementById('backFromTopBtn').addEventListener('click', showMenu);
            document.getElementById('backFromSettingsBtn').addEventListener('click', showMenu);
            
            // –°–ª–∞–π–¥–µ—Ä –±–æ–º–±
            const bombSlider = document.getElementById('bombSlider');
            bombSlider.addEventListener('input', updateBombSlider);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('soundToggle').addEventListener('change', toggleSound);
            document.getElementById('vibrationToggle').addEventListener('change', toggleVibration);
            document.getElementById('themeToggle').addEventListener('change', toggleTheme);
        }
        
        function updateBombSlider() {
            const slider = document.getElementById('bombSlider');
            const value = parseInt(slider.value);
            
            document.getElementById('bombSliderValue').textContent = value;
            document.getElementById('bombCountDisplay').textContent = value;
            document.getElementById('menuBombCount').textContent = value;
            document.getElementById('menuCookieCount').textContent = (25 - value);
        }
        
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        function startGame() {
            const bombs = parseInt(document.getElementById('bombSlider').value);
            gameState = {
                grid: [],
                revealed: [],
                bombs: bombs,
                score: 0,
                cookiesFound: 0,
                gameOver: false,
                gameWon: false
            };
            
            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é —Å–µ—Ç–∫—É
            for (let i = 0; i < GRID_SIZE; i++) {
                gameState.grid[i] = [];
                gameState.revealed[i] = [];
                for (let j = 0; j < GRID_SIZE; j++) {
                    gameState.grid[i][j] = 0;
                    gameState.revealed[i][j] = false;
                }
            }
            
            // –†–∞–∑–º–µ—â–∞–µ–º –±–æ–º–±—ã
            let bombsPlaced = 0;
            while (bombsPlaced < bombs) {
                const x = Math.floor(Math.random() * GRID_SIZE);
                const y = Math.floor(Math.random() * GRID_SIZE);
                
                if (gameState.grid[y][x] === 0) {
                    gameState.grid[y][x] = -1;
                    bombsPlaced++;
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–µ—á–µ–Ω—å–∫–∞–º–∏
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (gameState.grid[i][j] === 0) {
                        gameState.grid[i][j] = 1;
                    }
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
            showGameScreen();
            updateGameUI();
            renderGameBoard();
        }
        
        function renderGameBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    if (gameState.revealed[i][j]) {
                        cell.classList.add('revealed');
                        if (gameState.grid[i][j] === 1) {
                            cell.classList.add('cookie');
                            cell.innerHTML = 'üç™';
                        } else if (gameState.grid[i][j] === -1) {
                            cell.classList.add('bomb');
                            cell.innerHTML = 'üí£';
                        }
                    }
                    
                    cell.addEventListener('click', () => handleCellClick(i, j));
                    board.appendChild(cell);
                }
            }
        }
        
        function handleCellClick(row, col) {
            if (gameState.gameOver || gameState.gameWon || gameState.revealed[row][col]) {
                return;
            }
            
            gameState.revealed[row][col] = true;
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('revealed');
            
            if (gameState.grid[row][col] === 1) {
                // –ü–µ—á–µ–Ω—å–∫–∞
                cell.classList.add('cookie');
                cell.innerHTML = 'üç™';
                
                gameState.cookiesFound++;
                gameState.score += COOKIE_POINTS;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                const totalCookies = GRID_SIZE * GRID_SIZE - gameState.bombs;
                if (gameState.cookiesFound === totalCookies) {
                    gameState.gameWon = true;
                    gameState.score += WIN_BONUS;
                    alert(`üéâ –ü–û–ë–ï–î–ê! –í—ã –Ω–∞—à–ª–∏ –≤—Å–µ –ø–µ—á–µ–Ω—å–∫–∏! –í–∞—à —Å—á–µ—Ç: ${gameState.score}`);
                    saveBestScore();
                }
                
            } else if (gameState.grid[row][col] === -1) {
                // –ë–æ–º–±–∞
                cell.classList.add('bomb');
                cell.innerHTML = 'üí£';
                
                gameState.gameOver = true;
                gameState.score = Math.max(0, gameState.score - BOMB_PENALTY);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –±–æ–º–±—ã
                for (let i = 0; i < GRID_SIZE; i++) {
                    for (let j = 0; j < GRID_SIZE; j++) {
                        if (gameState.grid[i][j] === -1 && !gameState.revealed[i][j]) {
                            gameState.revealed[i][j] = true;
                            const bombCell = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                            bombCell.classList.add('revealed', 'bomb');
                            bombCell.innerHTML = 'üí£';
                        }
                    }
                }
                
                alert(`üí• –ë–û–ú–ë–ê! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á–µ—Ç: ${gameState.score}`);
                saveBestScore();
            }
            
            updateGameUI();
        }
        
        function updateGameUI() {
            document.getElementById('currentScore').textContent = gameState.score;
            
            const totalCells = GRID_SIZE * GRID_SIZE;
            const revealedCells = gameState.revealed.flat().filter(Boolean).length;
            const cookiesLeft = (totalCells - gameState.bombs) - gameState.cookiesFound;
            const bombsLeft = gameState.bombs - (revealedCells - gameState.cookiesFound);
            
            document.getElementById('gameCookiesFound').textContent = 
                `${gameState.cookiesFound}/${totalCells - gameState.bombs}`;
            document.getElementById('gameBombsLeft').textContent = 
                `${bombsLeft > 0 ? bombsLeft : 0}/${gameState.bombs}`;
        }
        
        function giveHint() {
            if (gameState.gameOver || gameState.gameWon) return;
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—É—é —Å–∫—Ä—ã—Ç—É—é –ø–µ—á–µ–Ω—å–∫—É
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (!gameState.revealed[i][j] && gameState.grid[i][j] === 1) {
                        const cell = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                        cell.style.backgroundColor = '#FFD700';
                        cell.style.boxShadow = '0 0 10px #FFD700';
                        
                        setTimeout(() => {
                            cell.style.backgroundColor = '';
                            cell.style.boxShadow = '';
                        }, 1000);
                        
                        gameState.score = Math.max(0, gameState.score - 10);
                        updateGameUI();
                        return;
                    }
                }
            }
        }
        
        function restartGame() {
            if (confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É?')) {
                startGame();
            }
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ==========
        function showGameScreen() {
            hideAllScreens();
            document.getElementById('gameScreen').style.display = 'block';
            currentScreen = 'game';
        }
        
        function showMenu() {
            hideAllScreens();
            document.getElementById('menuScreen').style.display = 'block';
            currentScreen = 'menu';
            initMenu();
        }
        
        function showTopPlayers() {
            hideAllScreens();
            document.getElementById('topScreen').style.display = 'block';
            currentScreen = 'top';
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤
        }
        
        function showSettings() {
            hideAllScreens();
            document.getElementById('settingsScreen').style.display = 'block';
            currentScreen = 'settings';
        }
        
        function hideAllScreens() {
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('topScreen').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'none';
        }
        
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò –ò –°–û–•–†–ê–ù–ï–ù–ò–ï ==========
        function toggleSound() {
            soundEnabled = !soundEnabled;
            saveSettings();
        }
        
        function toggleVibration() {
            vibrationEnabled = !vibrationEnabled;
            saveSettings();
        }
        
        function toggleTheme() {
            const isDark = document.getElementById('themeToggle').checked;
            document.body.style.backgroundColor = isDark ? '#222' : '#f0f0f0';
            document.querySelector('.container').style.backgroundColor = isDark ? '#333' : 'white';
            document.querySelector('.container').style.color = isDark ? 'white' : 'black';
            saveSettings();
        }
        
        function loadSettings() {
            const savedSettings = localStorage.getItem('cookieBombSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                soundEnabled = settings.sound !== false;
                vibrationEnabled = settings.vibration !== false;
                
                document.getElementById('soundToggle').checked = soundEnabled;
                document.getElementById('vibrationToggle').checked = vibrationEnabled;
                document.getElementById('themeToggle').checked = settings.theme === 'dark';
                
                if (settings.theme === 'dark') {
                    toggleTheme();
                }
            }
        }
        
        function saveSettings() {
            const settings = {
                sound: soundEnabled,
                vibration: vibrationEnabled,
                theme: document.getElementById('themeToggle').checked ? 'dark' : 'light'
            };
            localStorage.setItem('cookieBombSettings', JSON.stringify(settings));
        }
        
        function saveBestScore() {
            if (gameState.score > bestScore) {
                bestScore = gameState.score;
                localStorage.setItem('cookieBombBestScore', bestScore);
                document.getElementById('bestScore').textContent = bestScore;
            }
        }
        
        function loadBestScore() {
            const savedScore = localStorage.getItem('cookieBombBestScore');
            if (savedScore) {
                bestScore = parseInt(savedScore);
                document.getElementById('bestScore').textContent = bestScore;
            }
        }
    </script>
</body>
</html>
