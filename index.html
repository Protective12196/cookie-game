<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç™ –ü–µ—á–µ–Ω—å–∫–∏ –∏ –ë–æ–º–±—ã üí£</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }
        
        /* Telegram –∫–Ω–æ–ø–∫–∏ */
        .tg-header {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tg-btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .stat-item {
            font-size: 1.2em;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        
        .cell {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        
        .cell:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .cell.cookie {
            background: rgba(139, 195, 74, 0.3);
            border: 2px solid #8BC34A;
        }
        
        .cell.bomb {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #F44336;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls {
            margin: 20px 0;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        .control-btn:hover {
            transform: scale(1.05);
        }
        
        /* –†–µ–π—Ç–∏–Ω–≥ */
        .leaderboard {
            margin-top: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        /* –î–ª—è –Ω–µ-Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .non-tg {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- Telegram Header (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="tg-header" id="tgHeader" style="display: none;">
        <div>
            <span id="username">–ò–≥—Ä–æ–∫</span>
            <div style="font-size: 12px;">ID: <span id="userid"></span></div>
        </div>
        <div>
            <button class="tg-btn" id="shareBtn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            <button class="tg-btn" id="closeBtn">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    
    <!-- –ò–≥—Ä–∞ -->
    <div class="game-container">
        <h1>üç™ –ü–µ—á–µ–Ω—å–∫–∏ –∏ –ë–æ–º–±—ã üí£</h1>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats">
            <div class="stat-item">
                <div>–°–ß–ï–¢</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-item">
                <div>–í–†–ï–ú–Ø</div>
                <div class="stat-value" id="time">30</div>
            </div>
            <div class="stat-item">
                <div>–£–†–û–í–ï–ù–¨</div>
                <div class="stat-value" id="level">1</div>
            </div>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
        <div class="game-board" id="gameBoard">
            <!-- –Ø—á–µ–π–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="controls">
            <button class="control-btn" id="startBtn">‚ñ∂Ô∏è –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            <button class="control-btn" id="pauseBtn" style="display: none;">‚è∏Ô∏è –ü–ê–£–ó–ê</button>
        </div>
        
        <!-- –ü—Ä–∞–≤–∏–ª–∞ -->
        <div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
            <h3>üéØ –ü–†–ê–í–ò–õ–ê:</h3>
            <p>‚Ä¢ –ö–ª–∏–∫–∞–π –Ω–∞ üç™ ‚Äî –ø–æ–ª—É—á–∞–µ—à—å +10 –æ—á–∫–æ–≤</p>
            <p>‚Ä¢ –ò–∑–±–µ–≥–∞–π üí£ ‚Äî —Ç–µ—Ä—è–µ—à—å -50 –æ—á–∫–æ–≤</p>
            <p>‚Ä¢ –£ —Ç–µ–±—è 30 —Å–µ–∫—É–Ω–¥!</p>
        </div>
        
        <!-- –†–µ–π—Ç–∏–Ω–≥ –¥–ª—è Telegram -->
        <div class="leaderboard" id="leaderboard" style="display: none;">
            <h3>üèÜ –¢–û–ü –ò–ì–†–û–ö–û–í:</h3>
            <div id="topPlayers">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <!-- –î–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –≤ Telegram -->
        <div class="non-tg" id="nonTg">
            <h3>üöÄ –•–æ—á–µ—à—å –∏–≥—Ä–∞—Ç—å –≤ Telegram?</h3>
            <a href="https://t.me/YourBotUsername" 
               style="display: inline-block; padding: 15px 30px; background: #0088cc; color: white; text-decoration: none; border-radius: 10px; font-size: 18px; margin-top: 15px;">
               üéÆ –û–¢–ö–†–´–¢–¨ –í TELEGRAM
            </a>
        </div>
    </div>
    
    <script>
        // ========== –¢–ï–õ–ï–ì–†–ê–ú –§–£–ù–ö–¶–ò–û–ù–ê–õ ==========
        const tg = window.Telegram?.WebApp;
        
        if (tg) {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
            tg.ready();
            tg.expand();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º Telegram header
            document.getElementById('tgHeader').style.display = 'flex';
            document.getElementById('leaderboard').style.display = 'block';
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = tg.initDataUnsafe?.user;
            if (user) {
                document.getElementById('username').textContent = user.first_name || '–ò–≥—Ä–æ–∫';
                document.getElementById('userid').textContent = user.id || '???';
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
            document.getElementById('shareBtn').onclick = () => {
                const shareText = `–Ø –Ω–∞–±—Ä–∞–ª ${score} –æ—á–∫–æ–≤ –≤ –∏–≥—Ä–µ "–ü–µ—á–µ–Ω—å–∫–∏ –∏ –ë–æ–º–±—ã"! üç™üí£\n–ü–æ–ø—Ä–æ–±—É–π –ø–æ–±–∏—Ç—å –º–æ–π —Ä–µ–∫–æ—Ä–¥!`;
                tg.shareURL(window.location.href, shareText);
            };
            
            // –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å"
            document.getElementById('closeBtn').onclick = () => {
                tg.close();
            };
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞ –≤ –±–æ—Ç–∞
            function sendScoreToBot(finalScore) {
                if (!user) return;
                
                const data = {
                    action: 'game_score',
                    user_id: user.id,
                    username: user.first_name,
                    score: finalScore,
                    game: 'cookies_and_bombs',
                    timestamp: Date.now()
                };
                
                tg.sendData(JSON.stringify(data));
                
                // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Bot API
                fetch(`https://api.telegram.org/bot${tg.initData}/sendGameScore`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                }).catch(e => console.log('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞:', e));
            }
            
        } else {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å –≤ Telegram"
            document.getElementById('nonTg').style.display = 'block';
        }
        
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        let score = 0;
        let timeLeft = 30;
        let level = 1;
        let gameActive = false;
        let gameTimer;
        let cookieCount = 3;
        let bombCount = 1;
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function generateBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            const totalCells = 16;
            const cells = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—á–µ–Ω—å–∫–∏
            for (let i = 0; i < cookieCount; i++) {
                cells.push({type: 'cookie', emoji: 'üç™', value: 10});
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–º–±—ã
            for (let i = 0; i < bombCount; i++) {
                cells.push({type: 'bomb', emoji: 'üí£', value: -50});
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
            while (cells.length < totalCells) {
                cells.push({type: 'empty', emoji: '‚¨ú', value: 0});
            }
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º
            shuffleArray(cells);
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–µ—Ç–∫–∏
            cells.forEach((cell, index) => {
                const cellDiv = document.createElement('div');
                cellDiv.className = `cell ${cell.type}`;
                cellDiv.textContent = cell.emoji;
                cellDiv.dataset.type = cell.type;
                cellDiv.dataset.value = cell.value;
                
                cellDiv.onclick = () => handleCellClick(cellDiv);
                
                board.appendChild(cellDiv);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleCellClick(cell) {
            if (!gameActive) return;
            
            const type = cell.dataset.type;
            const value = parseInt(cell.dataset.value);
            
            if (type === 'cookie') {
                score += value;
                cell.textContent = '‚úÖ';
                cell.style.background = 'rgba(76, 175, 80, 0.5)';
                playSound('cookie');
            } 
            else if (type === 'bomb') {
                score += value;
                if (score < 0) score = 0;
                cell.textContent = 'üí•';
                cell.style.background = 'rgba(244, 67, 54, 0.5)';
                playSound('bomb');
                showAlert('üí• –ë–û–ú–ë–ê! -50 –æ—á–∫–æ–≤!');
            }
            
            cell.style.pointerEvents = 'none';
            updateScore();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        function updateScore() {
            document.getElementById('score').textContent = score;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—á–µ—Ç –≤ Telegram (–∫–∞–∂–¥—ã–µ 10 –æ—á–∫–æ–≤)
            if (tg && score > 0 && score % 10 === 0) {
                setTimeout(() => sendScoreToBot(score), 100);
            }
        }
        
        // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('time').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                }
                
                // –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
                if (timeLeft === 20 || timeLeft === 10) {
                    level++;
                    bombCount++;
                    cookieCount++;
                    document.getElementById('level').textContent = level;
                    generateBoard();
                    showAlert(`üî• –£—Ä–æ–≤–µ–Ω—å ${level}! –ë–æ–ª—å—à–µ –±–æ–º–±!`);
                }
            }, 1000);
        }
        
        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            if (gameActive) return;
            
            score = 0;
            timeLeft = 30;
            level = 1;
            cookieCount = 3;
            bombCount = 1;
            gameActive = true;
            
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            
            updateScore();
            generateBoard();
            startTimer();
            
            if (tg) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function endGame() {
            clearInterval(gameTimer);
            gameActive = false;
            
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç –≤ Telegram
            if (tg) {
                sendScoreToBot(score);
                tg.HapticFeedback.notificationOccurred('success');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                showAlert(`üéÆ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n–í–∞—à —Å—á–µ—Ç: ${score}\n–£—Ä–æ–≤–µ–Ω—å: ${level}`);
            } else {
                showAlert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á–µ—Ç: ${score}`);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥
            updateLeaderboard();
        }
        
        // –ü–∞—É–∑–∞
        function togglePause() {
            if (!gameActive) return;
            
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
                document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–¨';
            } else {
                startTimer();
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è –ü–ê–£–ó–ê';
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function playSound(type) {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–∏ –ø–æ–∑–∂–µ
        }
        
        function showAlert(message) {
            alert(message);
        }
        
        function updateLeaderboard() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–∞ –∏–∑ –±–æ—Ç–∞
            document.getElementById('topPlayers').innerHTML = `
                <p>1. –í—ã: ${score} –æ—á–∫–æ–≤</p>
                <p>2. –ò–≥—Ä–æ–∫ 2: 150 –æ—á–∫–æ–≤</p>
                <p>3. –ò–≥—Ä–æ–∫ 3: 120 –æ—á–∫–æ–≤</p>
            `;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.getElementById('startBtn').onclick = startGame;
        document.getElementById('pauseBtn').onclick = togglePause;
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
        generateBoard();
    </script>
</body>
</html>
